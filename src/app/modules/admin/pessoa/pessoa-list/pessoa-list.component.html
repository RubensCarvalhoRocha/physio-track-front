<div class="flex flex-col flex-auto w-full">
    <div class="flex flex-col w-full max-w-screen-xl mx-auto p-3 md:p-4">
        <!-- TÃ­tulo e botÃ£o -->
        <div
            class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 w-full mb-4"
        >
            <h2
                class="text-2xl sm:text-3xl font-semibold tracking-tight leading-8 text-center sm:text-left"
            >
                Pacientes
            </h2>

            <button
                mat-raised-button
                color="primary"
                [routerLink]="['nova']"
                class="w-full sm:w-auto"
            >
                Novo Paciente
            </button>
        </div>

        <!-- Campo de busca -->
        <div class="w-full mb-6">
            <input
                class="bg-white border border-gray-300 rounded-md w-full p-3 shadow-sm text-base"
                matInput
                autocomplete="off"
                placeholder="Buscar por nome do paciente..."
                #searchField
                (keyup)="filtrarPessoas(searchField.value)"
            />
        </div>

        <!-- ðŸ“‹ Tabela (somente em telas mÃ©dias e grandes) -->
        <div
            class="overflow-x-auto bg-white rounded-md shadow-md border border-gray-100 w-full hidden sm:block"
        >
            <table
                mat-table
                matSort
                [dataSource]="pessoasDataSource"
                class="min-w-full text-sm"
            >
                <!-- Nome -->
                <ng-container matColumnDef="nome">
                    <th
                        mat-header-cell
                        *matHeaderCellDef
                        class="px-4 py-3 text-left font-semibold text-gray-700"
                    >
                        Nome
                    </th>
                    <td
                        mat-cell
                        *matCellDef="let pessoa"
                        class="px-4 py-3 break-words"
                    >
                        {{ pessoa.nome }}
                    </td>
                </ng-container>

                <!-- CPF -->
                <ng-container matColumnDef="cpf">
                    <th
                        mat-header-cell
                        *matHeaderCellDef
                        class="px-4 py-3 text-left font-semibold text-gray-700"
                    >
                        CPF
                    </th>
                    <td
                        mat-cell
                        *matCellDef="let pessoa"
                        class="px-4 py-3 break-all"
                    >
                        {{ pessoa.cpf }}
                    </td>
                </ng-container>

                <!-- Telefone -->
                <ng-container matColumnDef="telefone">
                    <th
                        mat-header-cell
                        *matHeaderCellDef
                        class="px-4 py-3 text-left font-semibold text-gray-700"
                    >
                        Telefone
                    </th>
                    <td mat-cell *matCellDef="let pessoa" class="px-4 py-3">
                        {{ pessoa.telefone }}
                    </td>
                </ng-container>

                <!-- AÃ§Ãµes -->
                <ng-container matColumnDef="acoes">
                    <th
                        mat-header-cell
                        *matHeaderCellDef
                        class="px-4 py-3 text-center font-semibold text-gray-700"
                    >
                        AÃ§Ãµes
                    </th>
                    <td
                        mat-cell
                        *matCellDef="let pessoa"
                        class="px-4 py-3 flex items-center justify-center flex-wrap gap-2"
                    >
                        <button
                            mat-icon-button
                            color="primary"
                            [routerLink]="[pessoa.id]"
                            [matTooltip]="'Editar'"
                        >
                            <mat-icon svgIcon="mat_outline:edit"></mat-icon>
                        </button>

                        <button
                            mat-icon-button
                            color="primary"
                            [routerLink]="['/atendimento/paciente', pessoa.id]"
                            [matTooltip]="'Ver atendimentos'"
                        >
                            <mat-icon
                                svgIcon="heroicons_outline:clipboard-list"
                            ></mat-icon>
                        </button>

                        <button
                            mat-icon-button
                            color="primary"
                            (click)="cadastrarAtendimento(pessoa.id)"
                            [matTooltip]="'Novo atendimento'"
                        >
                            <mat-icon svgIcon="feather:clipboard"></mat-icon>
                        </button>

                        <button
                            mat-icon-button
                            color="warn"
                            (click)="excluirPessoa(pessoa.id)"
                            [matTooltip]="'Excluir'"
                        >
                            <mat-icon
                                svgIcon="mat_outline:delete_outline"
                            ></mat-icon>
                        </button>
                    </td>
                </ng-container>

                <tr
                    mat-header-row
                    *matHeaderRowDef="pessoasTableColumns"
                    class="bg-gray-50"
                ></tr>
                <tr
                    mat-row
                    *matRowDef="let row; columns: pessoasTableColumns"
                    class="hover:bg-gray-50 transition"
                ></tr>
            </table>
        </div>

        <!-- ðŸ“± Cards (somente em telas pequenas) -->
        <div
            class="grid grid-cols-1 sm:hidden gap-4 w-full mt-4"
            *ngIf="pessoasDataSource?.data?.length"
        >
            <div
                *ngFor="let pessoa of pessoasDataSource.data"
                class="bg-white rounded-lg shadow-sm border p-4 flex flex-col gap-2"
            >
                <h3 class="text-lg font-semibold text-gray-800">
                    {{ pessoa.nome }}
                </h3>
                <p class="text-sm text-gray-600">
                    <span class="font-medium">CPF:</span> {{ pessoa.cpf }}
                </p>
                <p class="text-sm text-gray-600">
                    <span class="font-medium">Telefone:</span>
                    {{ pessoa.telefone || 'â€”' }}
                </p>

                <div class="flex justify-end flex-wrap gap-2 pt-2 border-t">
                    <button
                        mat-icon-button
                        color="primary"
                        [routerLink]="[pessoa.id]"
                        matTooltip="Editar"
                    >
                        <mat-icon svgIcon="mat_outline:edit"></mat-icon>
                    </button>

                    <button
                        mat-icon-button
                        color="primary"
                        [routerLink]="['/atendimento/paciente', pessoa.id]"
                        matTooltip="Ver atendimentos"
                    >
                        <mat-icon
                            svgIcon="heroicons_outline:clipboard-list"
                        ></mat-icon>
                    </button>

                    <button
                        mat-icon-button
                        color="primary"
                        (click)="cadastrarAtendimento(pessoa.id)"
                        matTooltip="Novo atendimento"
                    >
                        <mat-icon svgIcon="feather:clipboard"></mat-icon>
                    </button>

                    <button
                        mat-icon-button
                        color="warn"
                        (click)="excluirPessoa(pessoa.id)"
                        matTooltip="Excluir"
                    >
                        <mat-icon svgIcon="mat_outline:delete_outline"></mat-icon>
                    </button>
                </div>
            </div>
        </div>

        <!-- Nenhuma pessoa encontrada -->
        <div
            class="p-5 bg-white border rounded-md w-full text-center text-gray-600 mt-4"
            *ngIf="!pessoasDataSource?.data?.length"
        >
            Nenhum paciente encontrado.
        </div>

        <!-- Paginador -->
        <mat-paginator
            class="w-full mt-6"
            [pageSizeOptions]="[10, 25, 50, 100]"
            showFirstLastButtons
            aria-label="Selecione a pÃ¡gina"
        ></mat-paginator>
    </div>
</div>
